/* Chat wrapper */
.chatbox-wrapper {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
}

/* Chat container */
.chatbox-container {
  width: 100%;
  max-width: 350px;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.08);
  display: flex;
  flex-direction: column;
  height: 400px;
  overflow: hidden;
  margin: 0 auto;
}

/* Messenger-style header */
.chatbox-header {
  border-bottom: 1px solid #eee;
  padding: 16px 20px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

.chatbox-header-main {
  display: flex;
  align-items: center;
  width: 100%;
}

.chatbox-header-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 12px;
}

.chatbox-header-title {
  font-weight: 600;
  font-size: 1.1em;
  color: #050505;
}

/* Property context */
.chatbox-property-context {
  display: flex;
  align-items: center;
  gap: 12px;
  background: #23272f;
  padding: 12px 16px;
  border-radius: 10px;
  margin: 12px 0 0 0;
  color: #fff;
  max-width: 100%;
  width: 100%;
  box-sizing: border-box;
  align-self: stretch;
}

.chatbox-property-context img {
  width: 56px;
  height: 56px;
  border-radius: 8px;
  object-fit: cover;
  border: 2px solid #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.chatbox-property-info {
  flex: 1;
}

.chatbox-property-title {
  font-weight: 600;
  font-size: 1.05em;
  margin-bottom: 2px;
}

.chatbox-property-price {
  font-size: 0.98em;
  color: #a3e635;
}

.chatbox-property-link {
  margin-left: auto;
  background: linear-gradient(90deg,#2563eb 0%,#1e40af 100%);
  color: #fff;
  padding: 7px 16px;
  border-radius: 7px;
  font-weight: 600;
  text-decoration: none;
  font-size: 0.98em;
  box-shadow: 0 2px 8px rgba(37, 99, 235, 0.333);
}

/* Main content area */
.chatbox-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

/* Messages area */
.chatbox-messages {
  flex: 1;
  padding: 16px 12px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  background: #fff;
  gap: 2px;
}

.chatbox-empty {
  color: #888;
  text-align: center;
  margin-top: 40px;
}

/* Input container */
.chatbox-input-container {
  width: 100%;
  background: #fff;
  box-sizing: border-box;
}

/* Messenger-style input row - FIXED: removed absolute positioning */
.chatbox-input-row {
  display: flex;
  border-top: 1px solid #e4e6eb;
  padding: 12px;
  background: #fff;
  align-items: center;
  gap: 8px;
  width: 100%;
  box-sizing: border-box;
}

.chatbox-input {
  flex: 1;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  margin-right: 8px;
  font-size: 0.9375rem;
}

.chatbox-send-button {
  padding: 10px 20px;
  border-radius: 8px;
  background: #2563eb;
  color: #fff;
  font-weight: 600;
  border: none;
  cursor: pointer;
  font-size: 0.9375rem;
}

.chatbox-send-button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.chatbox-send-button:hover:not(:disabled) {
  background: #1e40af;
}

/* Message row container */
.chatbox-message-row {
  display: flex;
  align-items: flex-end;
  margin: 1px 0;
  position: relative;
}

/* My messages: Right-aligned + Blue */
.chatbox-message-row.mine {
  justify-content: flex-end;
  padding-left: 60px;
}

/* Their messages: Left-aligned + Gray */
.chatbox-message-row.theirs {
  justify-content: flex-start;
  padding-right: 60px;
}

/* Basic message bubble styles */
.chatbox-message {
  border-radius: 18px;
  padding: 8px 12px;
  font-size: 0.9375rem;
  line-height: 1.3333;
  max-width: 60%;
  word-break: break-word;
  position: relative;
}

/* My message style */
.chatbox-message.me {
  background: #0084ff;
  color: #fff;
  margin-left: 4px;
  border-top-right-radius: 4px;
}

/* Their message style */
.chatbox-message.them {
  background: #e4e6eb;
  color: #050505;
  margin-right: 4px;
  border-top-left-radius: 4px;
}

/* Avatar styling */
.msg-avatar {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
  margin: 0 4px 2px;
  background: #e4e6eb;
  opacity: 1;
  transition: opacity 0.15s ease-in-out;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

/* Hide avatar while loading to prevent flicker */
.msg-avatar.loading {
  opacity: 0;
}

/* Ensure consistent space even when avatar is hidden */
.msg-avatar[style*="display: none"] {
  width: 28px;
  visibility: hidden !important;
  margin: 0 4px 2px;
}

/* Add spacing between sender changes */
.chatbox-message-row.mine + .chatbox-message-row.theirs,
.chatbox-message-row.theirs + .chatbox-message-row.mine {
  margin-top: 8px;
}

/* Group messages from same sender */
.chatbox-message-row:not(:first-child) {
  margin-top: 1px;
}

/* Add spacing between message groups */
.chatbox-message-row + .chatbox-message-row {
  margin-top: 4px;
}

/* Additional spacing when switching between senders */
.chatbox-message-row.mine + .chatbox-message-row.theirs,
.chatbox-message-row.theirs + .chatbox-message-row.mine {
  margin-top: 12px;
}

/* Message bubble positioning */
.chatbox-message-row.mine .chatbox-message {
  margin-right: 0;
  margin-left: 4px;
}

.chatbox-message-row.theirs .chatbox-message {
  margin-left: 0;
  margin-right: 4px;
}

/* small animation to reduce perceived jump */
.chatbox-message { 
  transition: transform 120ms ease, opacity 120ms ease; 
}
.chatbox-message-row { 
  min-height: 36px; 
}

/* Messenger-style avatars */
.chatbox-message-row.mine .msg-avatar {
  margin-left: 8px;
  margin-right: 0;
}

.chatbox-message-row.theirs .msg-avatar {
  margin-right: 8px;
  margin-left: 0;
}

/* Consecutive messages from same sender */
.chatbox-message-row.mine + .chatbox-message-row.mine .msg-avatar,
.chatbox-message-row.theirs + .chatbox-message-row.theirs .msg-avatar {
  opacity: 0;
  visibility: hidden;
}

/* large/embed variant */
.chatbox-container.large { 
  max-width: 100%; 
  height: 100%; 
  max-width: 600px;
  height: 80vh;
}

/* Page-level wrappers to ensure consistent layout when ChatBox is embedded */
.messages-page .messages-layout { height: 100%; }
.messages-list { padding: 0.75rem; box-sizing: border-box; }
.messages-area { padding: 1rem; box-sizing: border-box; display:flex; align-items:stretch; justify-content:center; }
.messages-area .chatbox-container.large { width: 100%; max-width: 720px; height: calc(80vh - 32px); }

/* small responsive tweaks */
@media (max-width: 480px) {
  .chatbox-container { 
    max-width: 100%; 
    height: 100%;
    border-radius: 0;
  }
  
  .chatbox-message { 
    font-size: 0.95rem; 
    max-width: 75%;
  }
  
  .chatbox-header {
    padding: 12px 16px;
  }
  
  .chatbox-messages {
    padding: 12px 8px;
  }
  
  .chatbox-input-row {
    padding: 8px 12px;
  }
}